<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Medical Report - {{ report.report_id }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 11pt;
            color: #000;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            border: 2px solid #1A3673;
            padding: 20px;
        }

        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo img {
            max-width: 400px;
            max-height: 200px;
            width: auto;
            height: auto;
        }

        .lab-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .lab-name {
            font-size: 24pt;
            font-weight: bold;
            color: #1A3673;
            margin-bottom: 10px;
        }

        .lab-info {
            font-size: 10pt;
            color: #4b5563;
            line-height: 1.4;
        }

        .report-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #1A3673;
        }

        .report-title {
            font-size: 16pt;
            font-weight: bold;
            color: #1A3673;
            margin-bottom: 10px;
        }

        .report-meta {
            font-size: 10pt;
            color: #6b7280;
        }

        .section-title {
            font-size: 14pt;
            font-weight: bold;
            color: #1A3673;
            margin-top: 25px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #1A3673;
        }

        .patient-info {
            margin-bottom: 25px;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .info-table td {
            padding: 8px;
            border: 1px solid #d1d5db;
        }

        .info-table td:first-child {
            font-weight: bold;
            background-color: #f9fafb;
            width: 35%;
        }

        .test-results {
            margin-bottom: 25px;
        }

        .category-name {
            font-size: 12pt;
            font-weight: bold;
            color: #4b5563;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .test-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 9pt;
        }

        .test-table thead {
            background-color: #1A3673;
            color: white;
        }

        .test-table th {
            padding: 8px;
            text-align: left;
            font-weight: bold;
        }

        .test-table td {
            padding: 8px;
            border: 1px solid #d1d5db;
        }

        .test-table tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }

        .status-normal {
            background-color: #d1fae5;
            color: #065f46;
            font-weight: bold;
        }

        .status-abnormal {
            background-color: #fed7aa;
            color: #92400e;
            font-weight: bold;
        }

        .status-critical {
            background-color: #fecaca;
            color: #991b1b;
            font-weight: bold;
        }

        .page-break {
            page-break-before: always;
        }

        .content-text {
            text-align: justify;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .content-text ul {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        .content-text li {
            margin-bottom: 8px;
        }

        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #d1d5db;
            font-size: 9pt;
            color: #6b7280;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Lab Logo -->
        {% if lab_settings.lab_logo %}
        <div class="logo">
            <img src="file://{{ media_root }}/{{ lab_settings.lab_logo }}" alt="Lab Logo">
        </div>
        {% endif %}

        <!-- Lab Header -->
        <div class="lab-header">
            <div class="lab-name">{{ lab_settings.lab_name }}</div>
            <div class="lab-info">
                {{ lab_settings.lab_address }}<br>
                {% if lab_settings.lab_phone %}Phone: {{ lab_settings.lab_phone }}<br>{% endif %}
                {% if lab_settings.lab_email %}Email: {{ lab_settings.lab_email }}{% endif %}
            </div>
        </div>

        <!-- Report Header -->
        <div class="report-header">
            <div class="report-title">MEDICAL LABORATORY REPORT</div>
            <div class="report-meta">
                <strong>Report ID:</strong> {{ report.report_id }}<br>
                <strong>Date:</strong> {{ report.date_created|date:"F d, Y \a\t h:i A" }}
            </div>
        </div>

        <!-- Patient Information -->
        <div class="patient-info">
            <div class="section-title">Patient Information</div>
            <table class="info-table">
                <tr>
                    <td>Patient Name:</td>
                    <td>{{ report.patient.name }}</td>
                </tr>
                <tr>
                    <td>Age:</td>
                    <td>{{ report.patient.age }} years</td>
                </tr>
                <tr>
                    <td>Gender:</td>
                    <td>{{ report.patient.get_gender_display }}</td>
                </tr>
                <tr>
                    <td>Contact:</td>
                    <td>{{ report.patient.contact_number|default:"N/A" }}</td>
                </tr>
            </table>
        </div>

        <!-- Test Results -->
        <div class="test-results">
            <div class="section-title">Laboratory Test Results</div>
            
            {% for category, tests in tests_by_category.items %}
            <div class="category-name">{{ category }}</div>
            <table class="test-table">
                <thead>
                    <tr>
                        <th>Test Name</th>
                        <th>Result</th>
                        <th>Unit</th>
                        <th>Normal Range</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for test in tests %}
                    <tr>
                        <td>{{ test.test_type.name }}</td>
                        <td style="text-align: right;">{{ test.result_value }}</td>
                        <td>{{ test.test_type.unit }}</td>
                        <td>
                            {% if test.test_type.normal_range_min and test.test_type.normal_range_max %}
                                {{ test.test_type.normal_range_min }} - {{ test.test_type.normal_range_max }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td class="status-{{ test.status }}">{{ test.get_status_display }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endfor %}
        </div>

        <!-- Diagnosis -->
        {% if report.diagnosis %}
        <div class="page-break">
            <div class="section-title">Diagnosis</div>
            <div class="content-text">
                {{ report.diagnosis|safe }}
            </div>
        </div>
        {% endif %}

        <!-- Recommendations -->
        {% if report.recommendations %}
        <div class="page-break">
            <div class="section-title">Recommendations</div>
            <div class="content-text">
                {{ report.recommendations|safe }}
            </div>
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            This report was generated on {{ now|date:"F d, Y \a\t h:i A" }}.
            {% if report.ai_generated %}This report includes AI-generated analysis.{% endif %}
        </div>
    </div>
</body>
</html>
